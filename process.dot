digraph commstars {
    "for specification in target_lists:" [shape="box"]
    Start [style="filled", color=lightgray]
    "for specification in target_lists:" [style="filled", color=lightgray]
    "compute_list(specification)" [style="filled", color=lightgray]
    "for nc in neighbor_criteria:" [shape="box"]
    compute_base_list [style="filled", color=lightyellow, label="compute_base_list [query_2mass]"]
    remove_extended_sources [style="filled", color=lightyellow]
    "for nc in neighbor_criteria:" [style="filled", color=lightyellow]
    find_stars_without_neighbors [style="filled", color=lightyellow]
    chunk_list [style="filled", color=pink]

    _process_chunk_for_neighbors [style="filled", color=pink]
    find_neighbors1 [label="find_neighbors [query_2mass]", style="filled", color=lightblue]; prune_stars_with_neighbors1 [label="prune_stars_with_neighbors", style="filled", color=lightblue]; gsc_prune_stars_with_neighbors1 [label="gsc_prune_stars_with_neighbors\n[GSC web service]", style="filled", color=lightblue]
    find_neighbors2 [label="find_neighbors [query_2mass]", style="filled", color=lightblue]; prune_stars_with_neighbors2 [label="prune_stars_with_neighbors", style="filled", color=lightblue]; gsc_prune_stars_with_neighbors2 [label="gsc_prune_stars_with_neighbors\n[GSC web service]", style="filled", color=lightblue]
    find_neighbors3 [label="find_neighbors [query_2mass]", style="filled", color=lightblue]; prune_stars_with_neighbors3 [label="prune_stars_with_neighbors", style="filled", color=lightblue]; gsc_prune_stars_with_neighbors3 [label="gsc_prune_stars_with_neighbors\n[GSC web service]", style="filled", color=lightblue]

    "append to output list" [style="filled", color=lightyellow]
    "copy final list to target_lists/" [style="filled", color=lightyellow]

    Start -> "for specification in target_lists:" -> "compute_list(specification)"
    "compute_list(specification)" -> compute_base_list -> remove_extended_sources -> "for nc in neighbor_criteria:"
    "for nc in neighbor_criteria:" -> find_stars_without_neighbors -> chunk_list -> _process_chunk_for_neighbors

    _process_chunk_for_neighbors -> "worker 1: chunk_00001" -> find_neighbors1 -> prune_stars_with_neighbors1 -> gsc_prune_stars_with_neighbors1 -> "append to output list"
    _process_chunk_for_neighbors -> "worker 2: chunk_00002" -> find_neighbors2 -> prune_stars_with_neighbors2 -> gsc_prune_stars_with_neighbors2 -> "append to output list"
    _process_chunk_for_neighbors -> "worker 3: chunk_00003 ..." -> find_neighbors3 -> prune_stars_with_neighbors3 -> gsc_prune_stars_with_neighbors3 -> "append to output list"

    "append to output list" -> "for nc in neighbor_criteria:"
    "append to output list" -> "copy final list to target_lists/"
    "copy final list to target_lists/" -> "for specification in target_lists:"
}